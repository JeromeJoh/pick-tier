# 会话存储功能测试指南

## 功能概述

Pick Tier 现在使用 sessionStorage 进行数据缓存，可以在页面刷新后自动恢复用户的数据，包括：
- 上传的图片元素
- 分级配置（标签、颜色）
- 元素的分级状态
- 下一个元素ID计数器

**重要特性**：sessionStorage 数据仅在当前浏览器标签页会话中有效，关闭标签页后数据会自动清除。

## 测试步骤

### 1. 基本存储测试
1. 打开应用
2. 上传几张图片
3. 将图片拖拽到不同的分级中
4. 修改分级标签和颜色
5. 刷新页面（F5 或 Ctrl+R）
6. **预期结果**：所有数据应该自动恢复

### 2. 会话隔离测试
1. 在当前标签页创建一些数据
2. 打开新标签页访问同一个应用
3. **预期结果**：新标签页应该是空白状态（没有数据）
4. 在新标签页创建不同的数据
5. 切换回原标签页
6. **预期结果**：原标签页的数据应该保持不变

### 3. 标签页关闭测试
1. 创建一些数据
2. 关闭标签页
3. 重新打开应用
4. **预期结果**：应该回到初始状态（数据已清除）

### 4. 自动保存测试
1. 上传图片后等待1秒（自动保存延迟）
2. 检查浏览器开发者工具 > Application > Session Storage
3. **预期结果**：应该看到 `pickTier_data` 键值对

### 5. 数据导出/导入测试
1. 创建一些数据（上传图片、分级）
2. 点击侧边栏的 "💾 Export Backup"
3. **预期结果**：下载一个JSON备份文件
4. 清空所有数据
5. 点击 "📂 Import Backup" 并选择刚才的备份文件
6. **预期结果**：所有数据应该恢复

### 6. 会话存储清理测试
1. 创建一些数据
2. 点击 "🧹 Clear Session"
3. 刷新页面
4. **预期结果**：应该回到初始状态

## 存储数据结构

```json
{
  "version": "1.0",
  "timestamp": 1641234567890,
  "data": {
    "elements": [
      {
        "id": 1,
        "name": "Element Name",
        "description": "Description",
        "src": "data:image/..."
      }
    ],
    "tiers": [
      {
        "id": "S",
        "label": "S",
        "color": "#ff7f7f",
        "elements": [1, 2]
      }
    ],
    "nextElementId": 3
  }
}
```

## sessionStorage vs localStorage 对比

### sessionStorage 特性
- ✅ 数据仅在当前标签页会话中有效
- ✅ 关闭标签页后自动清除数据
- ✅ 不同标签页之间数据隔离
- ✅ 页面刷新后数据保持
- ✅ 更好的隐私保护

### localStorage 特性
- ❌ 数据持久保存，需要手动清除
- ❌ 所有标签页共享数据
- ❌ 可能积累大量历史数据
- ✅ 跨会话数据保持

## 技术特性

### 自动保存
- 使用防抖技术，在数据变更后1秒自动保存
- 避免频繁的存储操作影响性能

### 版本控制
- 存储数据包含版本信息
- 版本不匹配时会忽略旧数据，使用默认配置

### 错误处理
- 存储不可用时会显示警告但不影响功能
- 数据损坏时会回退到默认状态

### 存储限制
- 使用 sessionStorage，通常有5-10MB限制
- 图片以 base64 格式存储，会占用较多空间
- 关闭标签页后数据自动清除，无需担心存储空间积累

## 故障排除

### 数据在刷新后丢失
- 检查浏览器是否支持 sessionStorage
- 检查是否在隐私模式下运行
- 查看浏览器控制台是否有错误信息

### 数据损坏
- 症状：页面加载时显示错误或数据异常
- 解决：清空会话存储重新开始

### 浏览器兼容性
- 现代浏览器都支持 sessionStorage
- 隐私模式可能限制存储功能

## 使用建议

1. **临时工作**：适合临时的分级工作，不需要长期保存
2. **隐私保护**：关闭标签页后数据自动清除，保护隐私
3. **多任务处理**：可以在不同标签页处理不同的分级任务
4. **定期备份**：重要数据建议使用导出功能保存到本地文件